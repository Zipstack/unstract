services:
  frontend:
    image: unstract/frontend:${VERSION}
    build:
      dockerfile: docker/dockerfiles/frontend.Dockerfile
      context: ..
      target: production
  backend:
    image: unstract/backend:${VERSION}
    build:
      dockerfile: docker/dockerfiles/backend.Dockerfile
      context: ..
  runner:
    image: unstract/runner:${VERSION}
    build:
      dockerfile: docker/dockerfiles/runner.Dockerfile
      context: ..
  tool-sidecar:
    image: unstract/tool-sidecar:${VERSION}
    build:
      dockerfile: docker/dockerfiles/tool-sidecar.Dockerfile
      context: ..
  tool-structure:
    image: unstract/tool-structure:${VERSION}
    build:
      dockerfile: ./Dockerfile
      context: ../tools/structure/
  platform-service:
    image: unstract/platform-service:${VERSION}
    build:
      dockerfile: docker/dockerfiles/platform.Dockerfile
      context: ..
  prompt-service:
    image: unstract/prompt-service:${VERSION}
    build:
      dockerfile: docker/dockerfiles/prompt.Dockerfile
      context: ..
  x2text-service:
    image: unstract/x2text-service:${VERSION}
    build:
      dockerfile: docker/dockerfiles/x2text.Dockerfile
      context: ..
  worker-api-deployment:
    image: unstract/worker-api-deployment:${VERSION}
    build:
      dockerfile: docker/dockerfiles/worker-api-deployment.Dockerfile
      context: ..
  worker-callback:
    image: unstract/worker-callback:${VERSION}
    build:
      dockerfile: docker/dockerfiles/worker-callback.Dockerfile
      context: ..
  worker-file-processing:
    image: unstract/worker-file-processing:${VERSION}
    build:
      dockerfile: docker/dockerfiles/worker-file-processing.Dockerfile
      context: ..
  # Unified worker image (replaces all individual worker images)
  worker-unified:
    image: unstract/worker-unified:${VERSION}
    build:
      dockerfile: docker/dockerfiles/worker-unified.Dockerfile
      context: ..
      args:
        MINIMAL_BUILD: ${MINIMAL_BUILD:-0}  # Set to 1 for faster dev builds

  # Legacy individual worker images (kept for backward compatibility)
  worker-general:
    image: unstract/worker-general:${VERSION}
    build:
      dockerfile: docker/dockerfiles/worker-general.Dockerfile
      context: ..
